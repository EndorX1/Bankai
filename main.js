/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var _=Object.create;var b=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty;var M=(i,o)=>{for(var e in o)b(i,e,{get:o[e],enumerable:!0})},k=(i,o,e,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let a of j(o))!V.call(i,a)&&a!==e&&b(i,a,{get:()=>o[a],enumerable:!(t=A(o,a))||t.enumerable});return i};var P=(i,o,e)=>(e=i!=null?_(F(i)):{},k(o||!i||!i.__esModule?b(e,"default",{value:i,enumerable:!0}):e,i)),$=i=>k(b({},"__esModule",{value:!0}),i);var J={};M(J,{default:()=>x});module.exports=$(J);var s=require("obsidian"),S=require("child_process"),f=P(require("path")),R=P(require("fs")),E="table-view",N={DownloadInterval:10,DownloadDirectory:"",PluginEnabled:!0},w="Name of the file",v="Subject",I="Folder Path to the file",m="Date Added",x=class extends s.Plugin{constructor(){super(...arguments);this.intervalId=null}async onload(){await this.loadSettings(),this.addCommand({id:"SyncDB",name:"Sync Database",callback:()=>this.SyncDatabase("sync")}),this.registerView(E,e=>new L(e,this)),this.addRibbonIcon("table","Open Database Searcher",()=>{this.activateView()}),this.addSettingTab(new C(this.app,this)),this.startInterval(this.settings.DownloadInterval)}onunload(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)}async loadSettings(){this.settings=Object.assign({},N,await this.loadData())}async isExeRunning(e){return new Promise(t=>{(0,S.exec)("tasklist",(a,n)=>{if(a){t(!1);return}let c=n.toLowerCase().includes(e.toLowerCase());t(c)})})}async activateView(){let{workspace:e}=this.app,t=null,a=e.getLeavesOfType(E);t=a.length>0?a[0]:e.getRightLeaf(!1),await(t==null?void 0:t.setViewState({type:E,active:!0})),e.revealLeaf(t)}startInterval(e){if(!this.settings.PluginEnabled){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null);return}this.intervalId!==null&&window.clearInterval(this.intervalId);let t=Math.max(1,Math.floor(e))*60*1e3;this.intervalId=window.setInterval(()=>this.SyncDatabase("sync"),t),this.registerInterval(this.intervalId)}SyncDatabase(e){let t=this.app.vault.adapter.basePath,a=this.manifest.id,n=f.join(t,this.settings.DownloadDirectory),c=f.join(t,".obsidian","Plugins",a),h=f.join(t,".obsidian","Plugins",a,"dependencies","dist","sync","sync.exe"),l=[n,c,e];this.isExeRunning("sync.exe").then(r=>{if(r){new s.Notice("Already syncing");return}e==="sync"?new s.Notice("Started Sync"):new s.Notice("Started Setup");let d=(0,S.spawn)(h,l);d.on("error",p=>{new s.Notice(`Failed to start sync: ${String(p)}`)}),d.stdout.on("data",p=>{e==="sync"?new s.Notice(String(p)):new s.Notice("Finished Setup")})})}resetData(){let e=this.app.vault.adapter.basePath,t=this.manifest.id,a=f.join(e,".obsidian","Plugins",t,"dependencies","browser_data");R.rmSync(a,{recursive:!0,force:!0}),new s.Notice("Data reset complete")}},L=class extends s.ItemView{constructor(e,t){super(e);this.allData=[];this.filteredData=[];this.plugin=t}getViewType(){return E}getDisplayText(){return"Table View"}async onOpen(){let e=this.containerEl.children[1];if(e){e.empty(),e.createEl("h2",{text:"Data Table"});try{this.allData=await this.loadJsonData(),this.filteredData=[...this.allData],this.createControls(e),this.createTable(e,this.filteredData)}catch(t){let a=t instanceof Error?t.message:String(t);e.createEl("p",{text:"Error loading data: "+a})}}}async loadJsonData(){let e=this.app.vault.adapter,a=`.obsidian/Plugins/${this.plugin.manifest.id}/dependencies/database.json`,n=await e.read(a),c=JSON.parse(n);return this.extractFiles(c)}extractFiles(e){let t=[],a=(n,c,h)=>{for(let l in n)if(l==="__FileData__"&&typeof n[l]=="object"&&n[l])for(let r in n[l])t.push({[w]:r,[v]:c,[I]:h,[m]:String(n[l][r])});else if(typeof n[l]=="object"&&n[l]!==null){let r=h?`${h}/${l}`:l;a(n[l],c,r)}};for(let n in e)a(e[n],n,n);return t}createControls(e){let t=e.createEl("div");t.style.marginBottom="20px";let a=t.createEl("input");a.type="text",a.placeholder="Search files...",a.style.width="100%",a.style.padding="8px",a.style.marginBottom="10px",a.addEventListener("input",()=>this.filterData(a.value));let n=t.createEl("div");n.style.marginBottom="10px";let c=n.createEl("button",{text:"Sort by Name"});c.style.marginRight="10px",c.addEventListener("click",()=>this.sortData(w)),n.createEl("button",{text:"Sort by Subject"}).addEventListener("click",()=>this.sortData(v));let l=n.createEl("button",{text:"Sort by Time"});l.style.marginLeft="10px",l.addEventListener("click",()=>this.sortDataReverse(m));let r=t.createEl("div");r.style.marginBottom="10px";let d=[...new Set(this.allData.map(y=>y[v]))],p=r.createEl("button",{text:"All"});p.style.marginRight="10px",p.addEventListener("click",()=>this.filterBySubject("")),d.forEach(y=>{let B=r.createEl("button",{text:y});B.style.marginRight="10px",B.addEventListener("click",()=>this.filterBySubject(y))});let u=t.createEl("div"),D=u.createEl("button",{text:"Today"});D.style.marginRight="10px",D.addEventListener("click",()=>this.filterByDays(0));let O=u.createEl("span",{text:"Last Days:"});O.style.marginRight="5px";let g=u.createEl("input");g.type="number",g.placeholder="7",g.style.width="50px",g.style.marginRight="5px",g.style.marginLeft="10px",g.addEventListener("input",()=>{let y=parseInt(g.value,10);Number.isNaN(y)||this.filterByDays(y)})}filterData(e){let t=e.trim().toLowerCase();t?this.filteredData=this.allData.filter(a=>a[w].toLowerCase().includes(t)||a[v].toLowerCase().includes(t)||a[I].toLowerCase().includes(t)||a[m].toLowerCase().includes(t)):this.filteredData=[...this.allData],this.updateTable()}sortData(e){this.filteredData.sort((t,a)=>t[e].localeCompare(a[e])),this.updateTable()}sortDataReverse(e){this.filteredData.sort((t,a)=>a[e].localeCompare(t[e])),this.updateTable()}filterBySubject(e){e?this.filteredData=this.allData.filter(t=>t[v]===e):this.filteredData=[...this.allData],this.updateTable()}filterByDays(e){let t=new Date,n=new Date(t.getFullYear(),t.getMonth(),t.getDate()-e).toISOString().split("T")[0];this.filteredData=this.allData.filter(c=>c[m].split(" ")[0]>=n),this.updateTable()}updateTable(){let e=this.containerEl.children[1];if(!e)return;let t=e.querySelector("table");t&&t.remove(),this.createTable(e,this.filteredData)}createTable(e,t){if(!t||t.length===0)return;let a=Object.keys(t[0]),n=e.createEl("table");n.style.width="100%",n.style.borderCollapse="collapse";let h=n.createEl("thead").createEl("tr");a.forEach(r=>{let d=h.createEl("th");d.textContent=r,d.style.border="1px solid var(--background-modifier-border)",d.style.padding="8px",d.style.backgroundColor="var(--background-secondary)"});let l=n.createEl("tbody");t.forEach(r=>{let d=l.createEl("tr");a.forEach(p=>{let u=d.createEl("td");u.textContent=r[p],u.style.border="1px solid var(--background-modifier-border)",u.style.padding="8px",p===w&&(u.style.cursor="pointer",u.style.color="var(--text-accent)",u.addEventListener("click",()=>{let D=`${r[I]}/${r[p]}`;navigator.clipboard.writeText(D),new s.Notice("Copied path to clipboard")}))})}),e.appendChild(n)}async onClose(){}},C=class extends s.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new s.Setting(e).setName("Enable").setDesc("Enables Plugin").addToggle(t=>t.setValue(this.plugin.settings.PluginEnabled).onChange(async a=>{this.plugin.settings.PluginEnabled=a,await this.plugin.saveData(this.plugin.settings),this.plugin.startInterval(this.plugin.settings.DownloadInterval)})),new s.Setting(e).setName("Download Interval (min)").setDesc("Time interval to update file database").addText(t=>t.setPlaceholder("Minutes").setValue(String(this.plugin.settings.DownloadInterval)).onChange(async a=>{let n=parseInt(a,10);this.plugin.settings.DownloadInterval=Number.isNaN(n)?N.DownloadInterval:n,await this.plugin.saveData(this.plugin.settings),this.plugin.startInterval(this.plugin.settings.DownloadInterval)})),new s.Setting(e).setName("Directory").setDesc("File saving location").addText(t=>t.setPlaceholder("").setValue(this.plugin.settings.DownloadDirectory).onChange(async a=>{this.plugin.settings.DownloadDirectory=a,await this.plugin.saveData(this.plugin.settings)})),new s.Setting(e).setName("Run Setup").setDesc("Initialize the plugin and download dependencies").addButton(t=>{t.setButtonText("Run Setup").onClick(()=>this.plugin.SyncDatabase("setup"))}),new s.Setting(e).setName("Reset Data").setDesc("Clear browser data and cookies. If you experience problems, try this.").addButton(t=>t.setButtonText("Reset Data").onClick(()=>new T(this.app,()=>this.plugin.resetData()).open()))}},T=class extends s.Modal{constructor(e,t){super(e);this.callback=t}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"Are you sure?"}),e.createEl("p",{text:"You will have to run setup again."});let t=e.createEl("div");t.style.display="flex",t.style.gap="10px",t.style.justifyContent="center",t.style.marginTop="20px",t.createEl("button",{text:"Yes"}).addEventListener("click",()=>{this.callback(),this.close()}),t.createEl("button",{text:"No"}).addEventListener("click",()=>this.close())}onClose(){let{contentEl:e}=this;e.empty()}};
