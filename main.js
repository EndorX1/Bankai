/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var _=Object.create;var b=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var j=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty;var M=(l,c)=>{for(var e in c)b(l,e,{get:c[e],enumerable:!0})},k=(l,c,e,t)=>{if(c&&typeof c=="object"||typeof c=="function")for(let a of V(c))!F.call(l,a)&&a!==e&&b(l,a,{get:()=>c[a],enumerable:!(t=A(c,a))||t.enumerable});return l};var R=(l,c,e)=>(e=l!=null?_(j(l)):{},k(c||!l||!l.__esModule?b(e,"default",{value:l,enumerable:!0}):e,l)),J=l=>k(b({},"__esModule",{value:!0}),l);var $={};M($,{default:()=>x});module.exports=J($);var n=require("obsidian"),I=require("child_process"),f=R(require("path")),P=R(require("fs")),D="table-view",N={DownloadInterval:10,DownloadDirectory:"",PluginEnabled:!0},m="Name of the file",v="Subject",S="Folder Path to the file",E="Date Added",x=class extends n.Plugin{constructor(){super(...arguments);this.intervalId=null}async onload(){await this.loadSettings(),this.addCommand({id:"SyncDB",name:"Sync Database",callback:()=>this.SyncDatabase("sync")}),this.registerView(D,e=>new L(e,this)),this.addRibbonIcon("table","Open Database Searcher",()=>{this.activateView()}),this.addSettingTab(new T(this.app,this)),this.startInterval(this.settings.DownloadInterval)}onunload(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)}async loadSettings(){this.settings=Object.assign({},N,await this.loadData())}async isExeRunning(e){return new Promise(t=>{(0,I.exec)("tasklist",(a,s)=>{if(a){t(!1);return}let i=s.toLowerCase().includes(e.toLowerCase());t(i)})})}async activateView(){let{workspace:e}=this.app,t=null,a=e.getLeavesOfType(D);t=a.length>0?a[0]:e.getRightLeaf(!1),await(t==null?void 0:t.setViewState({type:D,active:!0})),e.revealLeaf(t)}startInterval(e){if(!this.settings.PluginEnabled){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null);return}this.intervalId!==null&&window.clearInterval(this.intervalId);let t=Math.max(1,Math.floor(e))*60*1e3;this.intervalId=window.setInterval(()=>this.SyncDatabase("sync"),t),this.registerInterval(this.intervalId)}SyncDatabase(e){let t=this.app.vault.adapter.basePath,a=this.manifest.id,s=f.join(t,this.settings.DownloadDirectory),i=f.join(t,".obsidian","plugins",a),h=f.join(t,".obsidian","plugins",a,"dependencies","dist","sync","sync.exe"),r=[s,i,e];this.isExeRunning("sync.exe").then(o=>{if(o){new n.Notice("Already syncing");return}e==="sync"?(new n.Notice("Started Sync"),this.startInterval(this.settings.DownloadInterval)):(new n.Notice("Started Setup"),this.startInterval(this.settings.DownloadInterval)),(0,I.spawn)(h,r).stdout.on("data",u=>{e==="sync"?(new n.Notice("Finished Sync"),this.reloadTableView(),this.startInterval(this.settings.DownloadInterval)):(new n.Notice("Finished Setup"),this.startInterval(this.settings.DownloadInterval))})})}reloadTableView(){this.app.workspace.getLeavesOfType(D).forEach(t=>{let a=t.view;a&&a.reloadData&&a.reloadData()})}resetData(){let e=this.app.vault.adapter.basePath,t=this.manifest.id,a=f.join(e,".obsidian","plugins",t,"dependencies","browser_data");P.rmSync(a,{recursive:!0,force:!0}),new n.Notice("Data reset complete")}},L=class extends n.ItemView{constructor(e,t){super(e);this.allData=[];this.filteredData=[];this.syncTime="";this.plugin=t}getViewType(){return D}getDisplayText(){return"Table View"}async onOpen(){let e=this.containerEl.children[1];if(!e)return;e.empty();let t=e.createEl("div");t.style.display="flex",t.style.justifyContent="space-between",t.style.alignItems="center",t.style.marginBottom="20px",t.createEl("h2",{text:"Data Table"});try{this.allData=await this.loadJsonData(),this.filteredData=[...this.allData];let a=t.createEl("div");a.style.display="flex",a.style.alignItems="center",a.style.gap="15px";let s=a.createEl("button",{text:"Reload"});s.style.padding="4px 8px",s.addEventListener("click",()=>this.reloadData());let i=a.createEl("div");i.style.textAlign="right",i.style.fontSize="0.9em",i.style.color="var(--text-muted)",this.syncTime&&(i.createEl("div",{text:"Last Synced:"}),i.createEl("div",{text:this.syncTime})),this.createControls(e),this.createTable(e,this.filteredData)}catch(a){let s=a instanceof Error?a.message:String(a);e.createEl("p",{text:"Error loading data: "+s})}}async loadJsonData(){let e=this.app.vault.adapter,a=`.obsidian/plugins/${this.plugin.manifest.id}/dependencies/database.json`,s=await e.read(a),i=JSON.parse(s);return this.syncTime=i.SyncTime||"",this.extractFiles(i)}async reloadData(){try{this.allData=await this.loadJsonData(),this.filteredData=[...this.allData],this.onOpen()}catch(e){let t=e instanceof Error?e.message:String(e);new n.Notice("Error reloading data: "+t)}}extractFiles(e){let t=[],a=(s,i,h)=>{for(let r in s)if(r==="__FileData__"&&typeof s[r]=="object"&&s[r])for(let o in s[r])t.push({[m]:o,[v]:i,[S]:h,[E]:String(s[r][o])});else if(typeof s[r]=="object"&&s[r]!==null){let o=h?`${h}/${r}`:r;a(s[r],i,o)}};for(let s in e)a(e[s],s,s);return t}createControls(e){let t=e.createEl("div");t.style.marginBottom="20px";let a=t.createEl("input");a.type="text",a.placeholder="Search files...",a.style.width="100%",a.style.padding="8px",a.style.marginBottom="10px",a.addEventListener("input",()=>this.filterData(a.value));let s=t.createEl("div");s.style.marginBottom="10px";let i=s.createEl("button",{text:"Sort by Name"});i.style.marginRight="10px",i.addEventListener("click",()=>this.sortData(m)),s.createEl("button",{text:"Sort by Subject"}).addEventListener("click",()=>this.sortData(v));let r=s.createEl("button",{text:"Sort by Time"});r.style.marginLeft="10px",r.addEventListener("click",()=>this.sortDataReverse(E));let o=t.createEl("div");o.style.marginBottom="10px";let p=[...new Set(this.allData.map(y=>y[v]))],u=o.createEl("button",{text:"All"});u.style.marginRight="10px",u.addEventListener("click",()=>this.filterBySubject("")),p.forEach(y=>{let B=o.createEl("button",{text:y});B.style.marginRight="10px",B.addEventListener("click",()=>this.filterBySubject(y))});let d=t.createEl("div"),w=d.createEl("button",{text:"Today"});w.style.marginRight="10px",w.addEventListener("click",()=>this.filterByDays(0));let O=d.createEl("span",{text:"Last Days:"});O.style.marginRight="5px";let g=d.createEl("input");g.type="number",g.placeholder="7",g.style.width="50px",g.style.marginRight="5px",g.style.marginLeft="10px",g.addEventListener("input",()=>{let y=parseInt(g.value,10);Number.isNaN(y)||this.filterByDays(y)})}filterData(e){let t=e.trim().toLowerCase();t?this.filteredData=this.allData.filter(a=>a[m].toLowerCase().includes(t)||a[v].toLowerCase().includes(t)||a[S].toLowerCase().includes(t)||a[E].toLowerCase().includes(t)):this.filteredData=[...this.allData],this.updateTable()}sortData(e){this.filteredData.sort((t,a)=>t[e].localeCompare(a[e])),this.updateTable()}sortDataReverse(e){this.filteredData.sort((t,a)=>a[e].localeCompare(t[e])),this.updateTable()}filterBySubject(e){e?this.filteredData=this.allData.filter(t=>t[v]===e):this.filteredData=[...this.allData],this.updateTable()}filterByDays(e){let t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()-e).toISOString().split("T")[0];this.filteredData=this.allData.filter(i=>i[E].split(" ")[0]>=s),this.updateTable()}updateTable(){let e=this.containerEl.children[1];if(!e)return;let t=e.querySelector("table");t&&t.remove(),this.createTable(e,this.filteredData)}createTable(e,t){if(!t||t.length===0)return;let a=Object.keys(t[0]),s=e.createEl("table");s.style.width="100%",s.style.borderCollapse="collapse";let h=s.createEl("thead").createEl("tr");a.forEach(o=>{let p=h.createEl("th");p.textContent=o,p.style.border="1px solid var(--background-modifier-border)",p.style.padding="8px",p.style.backgroundColor="var(--background-secondary)"});let r=s.createEl("tbody");t.forEach(o=>{let p=r.createEl("tr");a.forEach(u=>{let d=p.createEl("td");d.textContent=o[u],d.style.border="1px solid var(--background-modifier-border)",d.style.padding="8px",u===m&&(d.style.cursor="pointer",d.style.color="var(--text-accent)",d.addEventListener("click",()=>{let w=`${o[S]}/${o[u]}`;navigator.clipboard.writeText(w),new n.Notice("Copied path to clipboard")}))})}),e.appendChild(s)}async onClose(){}},T=class extends n.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new n.Setting(e).setName("Enable").setDesc("Enables Plugin").addToggle(t=>t.setValue(this.plugin.settings.PluginEnabled).onChange(async a=>{this.plugin.settings.PluginEnabled=a,await this.plugin.saveData(this.plugin.settings),this.plugin.startInterval(this.plugin.settings.DownloadInterval)})),new n.Setting(e).setName("Download Interval (min)").setDesc("Time interval to update file database").addText(t=>t.setPlaceholder("Minutes").setValue(String(this.plugin.settings.DownloadInterval)).onChange(async a=>{let s=parseInt(a,10);this.plugin.settings.DownloadInterval=Number.isNaN(s)?N.DownloadInterval:s,await this.plugin.saveData(this.plugin.settings),this.plugin.startInterval(this.plugin.settings.DownloadInterval)})),new n.Setting(e).setName("Directory").setDesc("File saving location").addText(t=>t.setPlaceholder("").setValue(this.plugin.settings.DownloadDirectory).onChange(async a=>{this.plugin.settings.DownloadDirectory=a,await this.plugin.saveData(this.plugin.settings)})),new n.Setting(e).setName("Run Setup").setDesc("Initialize the plugin and download dependencies").addButton(t=>{t.setButtonText("Run Setup").onClick(()=>this.plugin.SyncDatabase("setup"))}),new n.Setting(e).setName("Reset Data").setDesc("Clear browser data and cookies. If you experience problems, try this.").addButton(t=>t.setButtonText("Reset Data").onClick(()=>new C(this.app,()=>this.plugin.resetData()).open()))}},C=class extends n.Modal{constructor(e,t){super(e);this.callback=t}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"Are you sure?"}),e.createEl("p",{text:"You will have to run setup again."});let t=e.createEl("div");t.style.display="flex",t.style.gap="10px",t.style.justifyContent="center",t.style.marginTop="20px",t.createEl("button",{text:"Yes"}).addEventListener("click",()=>{this.callback(),this.close()}),t.createEl("button",{text:"No"}).addEventListener("click",()=>this.close())}onClose(){let{contentEl:e}=this;e.empty()}};
