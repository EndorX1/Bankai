/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var A=Object.create;var w=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var M=Object.getPrototypeOf,U=Object.prototype.hasOwnProperty;var F=(c,d)=>{for(var e in d)w(c,e,{get:d[e],enumerable:!0})},R=(c,d,e,t)=>{if(d&&typeof d=="object"||typeof d=="function")for(let n of V(d))!U.call(c,n)&&n!==e&&w(c,n,{get:()=>d[n],enumerable:!(t=_(d,n))||t.enumerable});return c};var P=(c,d,e)=>(e=c!=null?A(M(c)):{},R(d||!c||!c.__esModule?w(e,"default",{value:c,enumerable:!0}):e,c)),J=c=>R(w({},"__esModule",{value:!0}),c);var W={};F(W,{default:()=>x});module.exports=J(W);var l=require("obsidian"),I=require("child_process"),b=P(require("path")),O=P(require("fs")),m="table-view",N={DownloadInterval:10,DownloadDirectory:"",PluginEnabled:!0},D="Name of the file",v="Subject",S="Folder Path to the file",E="Date Added",x=class extends l.Plugin{constructor(){super(...arguments);this.intervalId=null;this.buttonUpdateIntervalId=null}async onload(){await this.loadSettings(),this.addCommand({id:"SyncDB",name:"Sync Database",callback:()=>this.showSyncModal()}),this.registerView(m,e=>new B(e,this)),this.addRibbonIcon("table","Open Database Searcher",()=>{this.activateView()}),this.addSettingTab(new L(this.app,this)),this.startInterval(this.settings.DownloadInterval),this.startButtonUpdateInterval()}onunload(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.buttonUpdateIntervalId!==null&&(window.clearInterval(this.buttonUpdateIntervalId),this.buttonUpdateIntervalId=null)}async loadSettings(){this.settings=Object.assign({},N,await this.loadData())}async isExeRunning(e){return new Promise(t=>{(0,I.exec)("tasklist",(n,a)=>{if(n){t(!1);return}let s=a.toLowerCase().includes(e.toLowerCase());t(s)})})}async activateView(){let{workspace:e}=this.app,t=null,n=e.getLeavesOfType(m);t=n.length>0?n[0]:e.getRightLeaf(!1),await(t==null?void 0:t.setViewState({type:m,active:!0})),e.revealLeaf(t)}startInterval(e){if(!this.settings.PluginEnabled){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null);return}this.intervalId!==null&&window.clearInterval(this.intervalId);let t=Math.max(1,Math.floor(e))*60*1e3;this.intervalId=window.setInterval(()=>this.SyncDatabase("sync"),t),this.registerInterval(this.intervalId)}SyncDatabase(e,t=""){this.isExeRunning("sync.exe").then(n=>{if(n){new l.Notice("Already syncing");return}this.updateSyncButtons();let a=this.app.vault.adapter.basePath,s=this.manifest.id,i=b.join(a,this.settings.DownloadDirectory),o=b.join(a,".obsidian","plugins",s),r=b.join(a,".obsidian","plugins",s,"dependencies","dist","sync","sync.exe"),p=[i,o,e,t];e==="sync"?(new l.Notice("Started Sync"),this.startInterval(this.settings.DownloadInterval)):(new l.Notice("Started Setup"),this.startInterval(this.settings.DownloadInterval)),(0,I.spawn)(r,p).stdout.on("data",u=>{this.updateSyncButtons(),e==="sync"?(new l.Notice("Finished Sync"),this.reloadTableView(),this.startInterval(this.settings.DownloadInterval)):(new l.Notice("Finished Setup"),this.startInterval(this.settings.DownloadInterval))})})}startButtonUpdateInterval(){this.buttonUpdateIntervalId!==null&&window.clearInterval(this.buttonUpdateIntervalId),this.buttonUpdateIntervalId=window.setInterval(()=>this.updateSyncButtons(),1e4),this.registerInterval(this.buttonUpdateIntervalId)}updateSyncButtons(){this.isExeRunning("sync.exe").then(e=>{this.app.workspace.getLeavesOfType(m).forEach(n=>{let a=n.view;a&&a.updateSyncButton&&a.updateSyncButton(e)})})}reloadTableView(){this.app.workspace.getLeavesOfType(m).forEach(t=>{let n=t.view;n&&n.reloadData&&n.reloadData()})}async getSubjects(){try{let e=this.app.vault.adapter,n=`.obsidian/plugins/${this.manifest.id}/dependencies/database.json`,a=await e.read(n),s=JSON.parse(a);return Object.keys(s).filter(i=>i!=="SyncTime")}catch(e){return[]}}showSyncModal(){new T(this.app,this,e=>this.SyncDatabase("sync",e)).open()}resetData(){let e=this.app.vault.adapter.basePath,t=this.manifest.id,n=b.join(e,".obsidian","plugins",t,"dependencies","browser_data");O.rmSync(n,{recursive:!0,force:!0}),new l.Notice("Data reset complete")}},B=class extends l.ItemView{constructor(e,t){super(e);this.allData=[];this.filteredData=[];this.syncTime="";this.syncButton=null;this.plugin=t}getViewType(){return m}getDisplayText(){return"Table View"}async onOpen(){let e=this.containerEl.children[1];if(!e)return;e.empty();let t=e.createEl("div");t.style.display="flex",t.style.justifyContent="space-between",t.style.alignItems="center",t.style.marginBottom="20px",t.createEl("h2",{text:"Data Table"});try{this.allData=await this.loadJsonData(),this.filteredData=[...this.allData];let n=t.createEl("div");n.style.display="flex",n.style.alignItems="center",n.style.gap="15px";let a=n.createEl("div");a.style.display="flex",a.style.alignItems="center",a.style.gap="8px";let s=a.createEl("div");s.className="loader",s.style.display="none",s.style.fontSize="12px",s.style.width="1em",s.style.height="1em";let i=a.createEl("button",{text:"Sync"});this.syncButton=i,this.syncButton.setAttribute("data-spinner",s.outerHTML),i.style.padding="6px 12px",i.style.backgroundColor="var(--interactive-accent)",i.style.color="var(--text-on-accent)",i.style.border="none",i.style.borderRadius="4px",i.style.cursor="pointer",i.style.fontWeight="500",i.addEventListener("click",()=>this.plugin.showSyncModal()),i.addEventListener("mouseenter",()=>{i.style.backgroundColor="var(--interactive-accent-hover)"}),i.addEventListener("mouseleave",()=>{i.style.backgroundColor="var(--interactive-accent)"}),this.plugin.isExeRunning("sync.exe").then(p=>{this.updateSyncButton(p)});let o=n.createEl("button",{text:"Reload"});o.style.padding="4px 8px",o.addEventListener("click",()=>this.reloadData());let r=n.createEl("div");r.style.textAlign="right",r.style.fontSize="0.9em",r.style.color="var(--text-muted)",this.syncTime&&(r.createEl("div",{text:"Last Synced:"}),r.createEl("div",{text:this.syncTime})),this.createControls(e),this.createTable(e,this.filteredData)}catch(n){let a=n instanceof Error?n.message:String(n);e.createEl("p",{text:"Error loading data: "+a})}}async loadJsonData(){let e=this.app.vault.adapter,n=`.obsidian/plugins/${this.plugin.manifest.id}/dependencies/database.json`,a=await e.read(n),s=JSON.parse(a);return this.syncTime=s.SyncTime||"",this.extractFiles(s)}async reloadData(){try{this.allData=await this.loadJsonData(),this.filteredData=[...this.allData],this.onOpen()}catch(e){let t=e instanceof Error?e.message:String(e);new l.Notice("Error reloading data: "+t)}}extractFiles(e){let t=[],n=(a,s,i)=>{for(let o in a)if(o==="__FileData__"&&typeof a[o]=="object"&&a[o])for(let r in a[o])t.push({[D]:r,[v]:s,[S]:i,[E]:String(a[o][r])});else if(typeof a[o]=="object"&&a[o]!==null){let r=i?`${i}/${o}`:o;n(a[o],s,r)}};for(let a in e)a!=="SyncTime"&&n(e[a],a,a);return t}createControls(e){let t=e.createEl("div");t.style.marginBottom="20px";let n=t.createEl("input");n.type="text",n.placeholder="Search files...",n.style.width="100%",n.style.padding="8px",n.style.marginBottom="10px",n.addEventListener("input",()=>this.filterData(n.value));let a=t.createEl("div");a.style.marginBottom="10px";let s=a.createEl("button",{text:"Sort by Name"});s.style.marginRight="10px",s.addEventListener("click",()=>this.sortData(D)),a.createEl("button",{text:"Sort by Subject"}).addEventListener("click",()=>this.sortData(v));let o=a.createEl("button",{text:"Sort by Time"});o.style.marginLeft="10px",o.addEventListener("click",()=>this.sortDataReverse(E));let r=t.createEl("div");r.style.marginBottom="10px";let p=[...new Set(this.allData.map(g=>g[v]))],h=r.createEl("button",{text:"All"});h.style.marginRight="10px",h.addEventListener("click",()=>this.filterBySubject("")),p.forEach(g=>{let C=r.createEl("button",{text:g});C.style.marginRight="10px",C.addEventListener("click",()=>this.filterBySubject(g))});let u=t.createEl("div"),f=u.createEl("button",{text:"Today"});f.style.marginRight="10px",f.addEventListener("click",()=>this.filterByDays(0));let j=u.createEl("span",{text:"Last Days:"});j.style.marginRight="5px";let y=u.createEl("input");y.type="number",y.placeholder="7",y.style.width="50px",y.style.marginRight="5px",y.style.marginLeft="10px",y.addEventListener("input",()=>{let g=parseInt(y.value,10);Number.isNaN(g)||this.filterByDays(g)})}filterData(e){let t=e.trim().toLowerCase();t?this.filteredData=this.allData.filter(n=>n[D].toLowerCase().includes(t)||n[v].toLowerCase().includes(t)||n[S].toLowerCase().includes(t)||n[E].toLowerCase().includes(t)):this.filteredData=[...this.allData],this.updateTable()}sortData(e){this.filteredData.sort((t,n)=>t[e].localeCompare(n[e])),this.updateTable()}sortDataReverse(e){this.filteredData.sort((t,n)=>n[e].localeCompare(t[e])),this.updateTable()}filterBySubject(e){e?this.filteredData=this.allData.filter(t=>t[v]===e):this.filteredData=[...this.allData],this.updateTable()}filterByDays(e){let t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()-e).toISOString().split("T")[0];this.filteredData=this.allData.filter(s=>s[E].split(" ")[0]>=a),this.updateTable()}updateTable(){let e=this.containerEl.children[1];if(!e)return;let t=e.querySelector("table");t&&t.remove(),this.createTable(e,this.filteredData)}createTable(e,t){if(!t||t.length===0)return;let n=Object.keys(t[0]),a=e.createEl("table");a.style.width="100%",a.style.borderCollapse="collapse";let i=a.createEl("thead").createEl("tr");n.forEach(r=>{let p=i.createEl("th");p.textContent=r,p.style.border="1px solid var(--background-modifier-border)",p.style.padding="8px",p.style.backgroundColor="var(--background-secondary)"});let o=a.createEl("tbody");t.forEach(r=>{let p=o.createEl("tr");n.forEach(h=>{let u=p.createEl("td");u.textContent=r[h],u.style.border="1px solid var(--background-modifier-border)",u.style.padding="8px",h===D&&(u.style.cursor="pointer",u.style.color="var(--text-accent)",u.addEventListener("click",()=>{let f=`${r[S]}/${r[h]}`;navigator.clipboard.writeText(f),new l.Notice("Copied path to clipboard")}))})}),e.appendChild(a)}updateSyncButton(e){var n;if(!this.syncButton)return;let t=(n=this.syncButton.parentElement)==null?void 0:n.querySelector(".loader");if(t)if(e){if(this.syncButton.textContent="Syncing...",this.syncButton.disabled=!0,this.syncButton.style.cursor="not-allowed",t.style.display="inline-block",!document.querySelector("#sync-spinner-style")){let a=document.createElement("style");a.id="sync-spinner-style",a.textContent=`
					.loader {
						color: var(--text-accent);
						text-indent: -9999em;
						overflow: hidden;
						border-radius: 50%;
						position: relative;
						transform: translateZ(0);
						animation: mltShdSpin 2s infinite ease, round 2s infinite ease;
					}
					@keyframes mltShdSpin {
						0% { box-shadow: 0 -0.83em 0 -0.4em, 0 -0.83em 0 -0.42em, 0 -0.83em 0 -0.44em, 0 -0.83em 0 -0.46em, 0 -0.83em 0 -0.477em; }
						5%, 95% { box-shadow: 0 -0.83em 0 -0.4em, 0 -0.83em 0 -0.42em, 0 -0.83em 0 -0.44em, 0 -0.83em 0 -0.46em, 0 -0.83em 0 -0.477em; }
						10%, 59% { box-shadow: 0 -0.83em 0 -0.4em, -0.087em -0.825em 0 -0.42em, -0.173em -0.812em 0 -0.44em, -0.256em -0.789em 0 -0.46em, -0.297em -0.775em 0 -0.477em; }
						20% { box-shadow: 0 -0.83em 0 -0.4em, -0.338em -0.758em 0 -0.42em, -0.555em -0.617em 0 -0.44em, -0.671em -0.488em 0 -0.46em, -0.749em -0.34em 0 -0.477em; }
						38% { box-shadow: 0 -0.83em 0 -0.4em, -0.377em -0.74em 0 -0.42em, -0.645em -0.522em 0 -0.44em, -0.775em -0.297em 0 -0.46em, -0.82em -0.09em 0 -0.477em; }
						100% { box-shadow: 0 -0.83em 0 -0.4em, 0 -0.83em 0 -0.42em, 0 -0.83em 0 -0.44em, 0 -0.83em 0 -0.46em, 0 -0.83em 0 -0.477em; }
					}
					@keyframes round {
						0% { transform: rotate(0deg) }
						100% { transform: rotate(360deg) }
					}
				`,document.head.appendChild(a)}}else this.syncButton.textContent="Sync",this.syncButton.disabled=!1,this.syncButton.style.cursor="pointer",t.style.display="none"}async onClose(){}},L=class extends l.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new l.Setting(e).setName("Enable").setDesc("Enables Plugin").addToggle(t=>t.setValue(this.plugin.settings.PluginEnabled).onChange(async n=>{this.plugin.settings.PluginEnabled=n,await this.plugin.saveData(this.plugin.settings),this.plugin.startInterval(this.plugin.settings.DownloadInterval)})),new l.Setting(e).setName("Download Interval (min)").setDesc("Time interval to update file database").addText(t=>t.setPlaceholder("Minutes").setValue(String(this.plugin.settings.DownloadInterval)).onChange(async n=>{let a=parseInt(n,10);this.plugin.settings.DownloadInterval=Number.isNaN(a)?N.DownloadInterval:a,await this.plugin.saveData(this.plugin.settings),this.plugin.startInterval(this.plugin.settings.DownloadInterval)})),new l.Setting(e).setName("Directory").setDesc("File saving location").addText(t=>t.setPlaceholder("").setValue(this.plugin.settings.DownloadDirectory).onChange(async n=>{this.plugin.settings.DownloadDirectory=n,await this.plugin.saveData(this.plugin.settings)})),new l.Setting(e).setName("Run Setup").setDesc("Initialize the plugin and download dependencies").addButton(t=>{t.setButtonText("Run Setup").onClick(()=>this.plugin.SyncDatabase("setup"))}),new l.Setting(e).setName("Reset Data").setDesc("Clear browser data and cookies. If you experience problems, try this.").addButton(t=>t.setButtonText("Reset Data").onClick(()=>new k(this.app,()=>this.plugin.resetData()).open()))}},T=class extends l.Modal{constructor(e,t,n){super(e);this.callback=n,this.plugin=t}async onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"Select Sync Option"});let t=e.createEl("div");t.style.display="flex",t.style.flexDirection="column",t.style.gap="10px",t.style.marginTop="20px",t.createEl("button",{text:"Sync Whole Database"}).addEventListener("click",()=>{this.callback(),this.close()});let a=await this.plugin.getSubjects();a.length>0&&(e.createEl("p",{text:"Or select a specific subject:"}),a.forEach(s=>{t.createEl("button",{text:s}).addEventListener("click",()=>{this.callback(s),this.close()})}))}onClose(){let{contentEl:e}=this;e.empty()}},k=class extends l.Modal{constructor(e,t){super(e);this.callback=t}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"Are you sure?"}),e.createEl("p",{text:"You will have to run setup again."});let t=e.createEl("div");t.style.display="flex",t.style.gap="10px",t.style.justifyContent="center",t.style.marginTop="20px",t.createEl("button",{text:"Yes"}).addEventListener("click",()=>{this.callback(),this.close()}),t.createEl("button",{text:"No"}).addEventListener("click",()=>this.close())}onClose(){let{contentEl:e}=this;e.empty()}};
